<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de DVDs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- O CSS permanece exatamente o mesmo -->
    <style>
        /* Todo o CSS anterior permanece inalterado */
        /* ... */
    </style>
</head>
<body>
    <!-- O HTML permanece exatamente o mesmo até a tag <script> -->
    <!-- ... -->

    <script>
        // Variáveis globais
        let allFilms = [];
        let currentFilms = [];
        let currentPage = 1;
        const itemsPerPage = 20;
        let allGenres = [];
        let debounceTimer;
        let selectedGenre = '';
        
        // Função para limpar campos
        function cleanField(value) {
            if (!value) return '';
            return String(value).replace(/^"|"$/g, '').trim();
        }
        
        // Função para obter capa do DVD - MODIFICADA PARA USAR imageName E FALLBACK FIXO
        function getDvdCover(filmData) {
            const DEFAULT_COVER = 'capas/progdata.png';
            
            // Se tiver imageName definido no JSON, usa ele
            if (filmData.imageName) {
                return `capas/${filmData.imageName}.jpg`; // Assumindo extensão .jpg
            }
            
            // Fallback fixo - não procura mais no "Nome do Programa"
            return DEFAULT_COVER;
        }
        
        // Classificação por cores - Retorna a classe CSS correspondente
        function getClassificationClass(age) {
            if (!age || age <= 0) return 'L';
            
            const ageNum = typeof age === 'string' ? parseInt(age) : age;
            
            switch(ageNum) {
                case 10: return 'ten';
                case 12: return 'twelve';
                case 14: return 'fourteen';
                case 16: return 'sixteen';
                case 18: return 'eighteen';
                default: return 'L';
            }
        }
        
        // Transformar dados do JSON - AJUSTADA PARA O NOVO FORMATO
        function transformFilmData(originalFilm) {
            // Tratamento especial para nota IMDB (agora é um objeto)
            let imdbData = { votantes: '' };
            if (originalFilm["nota imdb"] && originalFilm["nota imdb"].votantes) {
                imdbData = { votantes: originalFilm["nota imdb"].votantes };
            }
            
            return {
                title: cleanField(originalFilm["Título do filme"]),
                director: cleanField(originalFilm["Direção"]),
                cast: cleanField(originalFilm["Elenco"]),
                duration: parseInt(originalFilm["Dur.(´)"]) || 0,
                genre: cleanField(originalFilm["GEN."]),
                year: parseInt(originalFilm["Ano"]) || 0,
                imdb: imdbData,
                country: cleanField(originalFilm["País"]),
                state: cleanField(originalFilm["UF"]),
                city: cleanField(originalFilm["cidade"]),
                audiodescricao: cleanField(originalFilm["Audiodescrição"]),
                closedCaption: cleanField(originalFilm["Closed Caption"]),
                synopsis: cleanField(originalFilm["Sinopse"]),
                tema: cleanField(originalFilm["tema (Programadora Brasil)"]),
                tags: cleanField(originalFilm["tags"]),
                website: cleanField(originalFilm["website"]),
                portaCurta: cleanField(originalFilm["Porta Curta"]),
                festivais: cleanField(originalFilm["festivais"]),
                premios: cleanField(originalFilm["premios"]),
                legendasOutras: cleanField(originalFilm["legendas_outras"]),
                materialOutros: cleanField(originalFilm["material_outros"]),
                duracaoFormato: cleanField(originalFilm["duracao FORMATO"]),
                nossoAcervo: cleanField(originalFilm["Nosso Acervo"]),
                pgm: parseInt(originalFilm["PGM"]) || 0,
                filmes: parseInt(originalFilm["Filmes"]) || 0,
                dvd: cleanField(originalFilm["Nome do Programa"]),
                imageName: cleanField(originalFilm["imageName"]),
                classification: parseInt(originalFilm["Classificação Indicativa POR PGM"]) || 0
            };
        }

        // Função para criar a imagem com fallback - MODIFICADA PARA TENTAR JPG E PNG
        function createSmartPoster(film) {
            const img = new Image();
            img.className = 'film-poster';
            img.alt = film.title || 'Capa do filme';
            
            // Tentará carregar nesta ordem:
            const attempts = [
                getDvdCover(film),      // Tenta o caminho principal
                getDvdCover(film).replace('.jpg', '.png'), // Tenta PNG se for JPG
                'capas/progdata.png'    // Fallback obrigatório
            ];

            let currentAttempt = 0;
            
            const tryNext = () => {
                if (currentAttempt < attempts.length) {
                    img.src = attempts[currentAttempt++];
                }
            };

            img.onerror = tryNext;
            tryNext(); // Inicia o processo

            return img;
        }

        // O restante do código JavaScript permanece exatamente o mesmo
        // ...
        
        // Na função openModal, atualize a linha da imagem para:
        modalContent.innerHTML = `
            <div class="modal-poster-container">
                <img src="${getDvdCover(film)}" alt="${film.title}" class="modal-poster" onerror="this.src='capas/progdata.png'">
            </div>
            <!-- Restante do modal permanece igual -->
            ...
        `;

        // Inicialização
        window.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadCatalogData();
        });
    </script>
</body>
</html>

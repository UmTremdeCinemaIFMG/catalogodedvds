<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de DVDs</title>
    <style>
        :root {
            --verde-ifmg: #009a44;
            --verde-escuro: #007236;
            --cinza-escuro: #333333;
            --cinza-medio: #666666;
            --cinza-claro: #f2f2f2;
            --branco: #ffffff;
            --azul: #0066cc;
            --amarelo: #ffcc00;
            --laranja: #ff9900;
            --vermelho: #cc0000;
            --preto: #000000;
        }
        
        /* [Manter todo o CSS anterior igual] */
        /* ... (todo o CSS permanece exatamente como estava) ... */
    </style>
</head>
<body>
    <!-- [Manter toda a estrutura HTML anterior igual] -->
    <!-- ... (todo o HTML permanece exatamente como estava) ... -->

    <script>
        // Variáveis globais (manter igual)
        let allFilms = [];
        let currentFilms = [];
        let currentPage = 1;
        let itemsPerPage = 10;
        let allGenres = [];
        let dvdCoverMap = {};

        // Função para limpar campos de texto
        function cleanField(value) {
            if (!value) return '';
            return String(value).replace(/^"|"$/g, '').trim();
        }

        // Função para obter capa do DVD (ajustada)
        function getCoverForDvd(dvdTitle) {
            if (!dvdTitle) return 'capas/progbrasil.png';
            
            const normalizedName = cleanField(dvdTitle)
                .toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .replace(/\s+/g, '_')
                .replace(/[^\w_]/g, '');
                
            return `capas/${normalizedName}.png`;
        }

        // Função para converter dados do JSON
        function transformFilmData(originalFilm) {
            return {
                title: cleanField(originalFilm["Título do filme"]),
                director: cleanField(originalFilm["Direção"]),
                cast: cleanField(originalFilm["Elenco"]),
                duration: parseInt(originalFilm["Dur.(´)"]) || 0,
                genre: cleanField(originalFilm["GEN."]),
                year: parseInt(originalFilm["Ano"]) || 0,
                imdb: originalFilm["nota imdb"]?.votantes || '',
                state: cleanField(originalFilm["UF"]),
                synopsis: cleanField(originalFilm["Sinopse"]),
                dvd: cleanField(originalFilm["Nome do Programa"]),
                classification: parseInt(originalFilm["Classificação Indicativa POR PGM"]) || 0,
                originalData: originalFilm // Mantém todos os dados originais
            };
        }

        // Carregar dados do JSON (adaptado)
        async function loadCatalogData() {
            try {
                const response = await fetch('catalogo.json');
                if (!response.ok) throw new Error('Erro ao carregar o arquivo');
                
                const data = await response.json();
                
                // Transforma os dados para o formato esperado
                allFilms = data.map(transformFilmData);
                
                // Extrair gêneros únicos
                allGenres = [...new Set(allFilms.map(film => film.genre).filter(Boolean))].sort();
                
                // Popular filtro de gêneros
                const genreFilter = document.getElementById('genreFilter');
                genreFilter.innerHTML = '<option value="">Todos</option>';
                allGenres.forEach(genre => {
                    const option = document.createElement('option');
                    option.value = genre;
                    option.textContent = genre;
                    genreFilter.appendChild(option);
                });
                
                // Inicializar filmes visíveis
                currentFilms = allFilms.slice(0, itemsPerPage);
                
                document.getElementById('loadingMessage').style.display = 'none';
                renderFilms();
                
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('loadingMessage').innerHTML = `
                    <p style="color: red">Erro ao carregar o catálogo</p>
                    <p>${error.message}</p>
                    <p>Verifique o console para detalhes (F12)</p>
                `;
            }
        }

        // [Manter todas as outras funções exatamente como estavam]
        // ... (getClassificationClass, filterAndRenderFilms, renderFilms, openModal, etc) ...

        // Inicialização
        window.addEventListener('DOMContentLoaded', () => {
            // [Manter o setupEventListeners() e loadCatalogData() como estavam]
            setupEventListeners();
            loadCatalogData();
        });
    </script>
</body>
</html>
